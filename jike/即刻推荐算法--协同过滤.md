# 推荐算法--协同过滤

## 概述

即刻是一个基于兴趣的社交平台，用户可以根据自己的兴趣和喜好在自己喜欢的圈子，加入该圈子并找到自己喜欢的内容，甚至扩展自己的社交圈。不过即刻包含了海量的圈子，搞笑的、穿搭的、职场的，各式各样，应有尽有。因此如何让用户能简单、快速的找到自己喜欢的圈子，做好个性化推荐就显的格外重要。

在个性化推荐系统中，协同过滤算法往往是一种非常行之有效的方法。目前，工业界流行的协同过滤算法有多种[类别](http://downloads.hindawi.com/journals/aai/2009/421425.pdf)，比如memory-based类算法，model-based类算法，以及其它各种混合推荐算法等。其中[ALS](https://datajobs.com/data-science-repo/Recommender-Systems-[Netflix].pdf)算法，一种潜语义模型，因为在Netflix Prize上表现良好，而受到业内人士的一致关注和使用，而spark mllib上亦有ALS算法的实现。因此，我们在做协同过滤算法选型的时候，选用该算法应用于用户对新圈子的兴趣探索中。

## 算法介绍
ALS算法为了算出user-item得分矩阵中空白位置的数值，采用了矩阵分解的方式进行求解，其详细思路和求解过程如下：

1. 根据一个user-content-rating的评分数据集，需要建立一个user-content的n*m的矩阵，(其中n为user的数量，m为content的数量)
2. 因为ALS基于的假设是用户-潜语义-内容。和LDA等算法类似，内容中具有多种潜语义，而用户因为对不同语义有不同的偏好，从而对不同内容产生有不同的偏好。因此用户内容的R(n*m)得分矩阵可以表示为U[n*k] * V[k*m]的矩阵，其中k为潜语义的个数，U矩阵表示用户对k个潜语义的偏好，V矩阵表示内容对k个潜语义进行了不同程度的阐述；
3. 在作出这种基本假设之后，接下来需要做的事情就相对比较明确了。在给定k值的情况下，通过矩阵R来求解出最优的U和V
4. 一种常见的解法(也是spark-ml的解法)是用最小二乘法来求解U和V：
    1. 先为U和V中的任意一个矩阵，给出一个随机的结果，并固定；// 假设先固定V
    2. 然后，在用已知的R和V来求解该情况下最优的U，方法是[最小二乘法](https://zh.wikipedia.org/wiki/%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%95)求解。
    3. 得到上一步的U之后，将U作为已知，用R和U来求解V
    4. 然后依次迭代，直到最小二乘法结果的E满足一定条件，或者迭代次数完成之后终止迭代；
    5. 得到最终的U和V；
5. 得到的U即为用户对k个潜语义的偏好，V即为内容和k个潜语义之间的关系。

## 算法实战
以上我们基本介绍了ALS算法的基本思想，接下来我们简单介绍一下ALS算法在即刻圈子推荐中的应用情况。为了使用方便，我们选择了spark平台进行算法计算，并使用了spark-ml中的ALS算法。spark-ml的ALS算法实现中，有显式与隐式反馈两种模式。其中，显式反馈主要是用户给电影评级，然而在更多的推荐应用中，我们得到的反馈往往是点击、点赞、收藏、购买等行为数据，因此需要用“隐式反馈数据集的协同过滤“来处理这类数据。本质上来说它不是直接对评分矩阵进行建模，而是将数据当作数值来看待。

我们在使用ALS进行用户圈子推荐时，我们对以上两者模型都进行了尝试。主要流程如下：

1. 收集所有用户对圈子(或主题下的消息)的不同行为：查看、点击、点赞、收藏、转发、关注、不感兴趣等，按一定的权值对这些行为进行累加，得到每个batch中，用户圈子的行为得分；
2. 然后在多个时间分片中，我们按时间缩减的方式，对多个时间分片中的用户圈子得分进行累加，得到最后的用户圈子得分。改得分可以用于隐式反馈模型的ALS中；
3. 通过某种方式，对用户圈子得分进行分级，用于显示反馈模型的ALS中。







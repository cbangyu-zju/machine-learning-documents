## 初探即刻推荐算法之协同过滤 (二)

### 
在以上三种不同类型的算法中，各有各的优势，有兴趣的同学可以自己去看[综述](http://downloads.hindawi.com/journals/aai/2009/421425.pdf)来进行了解。总的来说，memory-based算法简单粗暴有效，但是难就难在各种参数的调整上，比如不同相似度算法的选取，又比如在做截断加权平均时，如何调整截断的参数，再比如topN选取，一些参数的调整等等，在这些上面需要很多小trick。另外memory-based比较大的弊端，在面对冷启动问题基本上无能为力。因此为了提高算法的稳定性和可扩展性，我们一般都优先考虑model-based类型的算法。不过在model-based类型算法中，图模型算法复杂度较高，一般情况下不建议使用。而矩阵分解类型的model-based算法可以说是协同过滤算法中的首选。

即刻，正如其它内容分发公司一样，在进行协同过滤算法选型，算法的准确性、稳定性和可扩展性是主要考虑因素。因此，结合算法知识，矩阵分解类型的model-based类算法是首选。而在矩阵分解类型的model-based类算法中，[ALS](https://datajobs.com/data-science-repo/Recommender-Systems-[Netflix].pdf)算法，一种潜语义模型，因为在Netflix Prize上表现良好，而受到业内人士的一致关注和使用，而spark mllib上亦有ALS算法的实现。因此，ALS算法成为了即刻协同过滤算法的首选。ALS算法基本思想和求解过程如下：

1. 根据一个user-content-rating的评分数据集，需要建立一个user-content的n*m的矩阵，(其中n为user的数量，m为content的数量)
2. 因为ALS基于的假设是用户-潜语义-内容。和LDA等算法类似，内容中具有多种潜语义，而用户因为对不同语义有不同的偏好，从而对不同内容产生有不同的偏好。因此用户内容的R(n*m)得分矩阵可以表示为U[n*k] * V[k*m]的矩阵，其中k为潜语义的个数，U矩阵表示用户对k个潜语义的偏好，V矩阵表示内容对k个潜语义进行了不同程度的阐述；
3. 在作出这种基本假设之后，接下来需要做的事情就相对比较明确了。在给定k值的情况下，通过矩阵R来求解出最优的U和V
4. 一种常见的解法(也是spark-ml的解法)是用最小二乘法来求解U和V：
    1. 先为U和V中的任意一个矩阵，给出一个随机的结果，并固定；// 假设先固定V
    2. 然后，在用已知的R和V来求解该情况下最优的U，方法是[最小二乘法](https://zh.wikipedia.org/wiki/%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%95)求解。
    3. 得到上一步的U之后，将U作为已知，用R和U来求解V
    4. 然后依次迭代，直到最小二乘法结果的E满足一定条件，或者迭代次数完成之后终止跌倒
    5. 得到最终的U和V；
5. 得到的U即为用户对k个潜语义的偏好，V即为内容和k个潜语义之间的关系

### ALS算法实战
熟悉即刻APP的朋友应该都知道，即刻的内容主要分为主题和消息，消息依赖于主题而存在。每个主题是某一类主题性消息的聚合体，如“不好笑便利店”，“当天转发最多微博”，“洋葱日报社有更新”等。因此虽然消息是每天都在变化的，但是主题的性质是相对稳定的。在这种情况下，通过协同过滤计算出用户-主题关系，比实时计算用户-消息关系更为简单，有效。因此在即刻的协同过滤算法中，其主体是用户-主题。选好了推荐主体(用户-主题)后，接下来需要建立的计算用户-主题得分矩阵。我们通过以下步骤来获取有效的用户-得分矩阵：

1. 收集所有用户对主题(或主题下的消息)的不同行为：查看、点击、点赞、收藏、转发、关注、不感兴趣等。按一定的权值对这些行为进行累加，从而获得原始的用户-主题得分矩阵；
2. 我们的主题是有分类的，而不同分类下的内容区分度非常高，如经济、军事、影视等不同分类，因此利用已有的分类信息对用户-主题得分矩阵安主题分类进行切割，得到k各分类下的用户-主题得分矩阵；
3. 另外在这个原始得分矩阵中，新用户和老用户对主题的得分存在着严重的不平等性，比如老用户在主题的得分基本都是略强于新用户，因此需要做一定的归一化。在此，我们选择对单个用户做归一化处理，因为每个用户对内容的喜好都是相对的；当然这里还有一些最大值和最小值的截断；

自此我们得到了各分类下，归一化之后的用户-主题得分，按训练集和测试集进行分割，然后带入ALS算法中，即可预测出所有用户对所有主题的喜好值。得到模型之后，可以用用测试集对算法结果进行评估。如果评估效果好，则该算法模型通过，并利用该模型为每位用户输出等分较高的topN主题。

### 总结
在即刻协同过滤算法实践中，在有限的信息条件下，仅有的主题分类和用户-主题行为信息，上述推荐流程是一种较为快速、准确且有效的个性化推荐策略。目前即刻也靠着这种推荐算法和策略，初步的实现了个性化推荐的效果，也受到了大部分用户的认可，对即刻APP的时长和留存有较大的提升。

但是，显然的，上述协同过滤算法过程中，有很多需要质疑的地方：

1. 用户-主题得分问题：用户-主题得分的生成和归一化过程，是一个比较trick的过程，因此训练数据本身的准确性就是需要质疑的地方，因此无论算法有多强，都解决不了这个问题；
2. 冷启动问题：
	1. 用户冷启动：ALS算法中，需要设置k个潜语义，因此如果很多用户消费的主题量小于k，则容易造成算法的过拟合问题，因此需要过滤掉消费主题数小于k的用户，这就形成了新用户冷启动问题；因此，为了缓解这个问题，一般在保证准确性的前提下，尽量降低k值；
	2. 主题冷启动：和上述类似，一个新的主题也面临着这个问题；不过在即刻中，这个问题基本不存在，因为一个新主题，在推荐流上线一天，其消费的用户也远远大于k值，所以主题冷启动问题基本不存在。

综上两种问题，在主题的个性化推荐上，我们需要引进更明确的数据，利用更多特征的模型来解决这些问题。期待下一次分享，谢谢～






